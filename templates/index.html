<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ลุงแมน 1993 • King </title>
<meta name="color-scheme" content="dark light" />
<style>
:root{
  --bg:#06070a;--ink:#e6f1ff;--muted:#9bb1c9;--line:#1e2535;--panel:#0c111b;
  --gold:#ffd54a;--amber:#ffb300;--ok:#30d158;--err:#ff453a;
  --input:#0f1625;--focus:#48cfff;--bar1:#22d3ee;--bar2:#10b981;
  --glow1:#22d3ee;--glow2:#a78bfa;--glow3:#ffb300
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;color:var(--ink);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;
  background:
    radial-gradient(1200px 800px at 10% -10%,#141a24 0%,#0a0f16 60%,#05070c 100%),var(--bg);
  overflow:hidden;display:grid;place-items:center;padding:16px
}
.grid{
  position:fixed;inset:-200vmax;pointer-events:none;z-index:0;opacity:.18;filter:blur(1px);
  background:
    linear-gradient(transparent 95%,rgba(255,255,255,.05) 96%) 0 0/44px 44px,
    linear-gradient(90deg,transparent 95%,rgba(255,255,255,.05) 96%) 0 0/44px 44px;
  animation:grid 36s linear infinite
}
@keyframes grid{to{transform:translate3d(88px,44px,0)}}

.card{
  position:relative;z-index:2;width:min(540px,94vw);
  background:linear-gradient(180deg,#111827 0%,#0b1220 100%);
  border:1px solid var(--line);border-radius:22px;padding:26px;
  box-shadow:0 18px 48px rgba(0,0,0,.55),inset 0 0 0 1px rgba(255,255,255,.03)
}
.card:before{
  content:"";position:absolute;inset:-2px;border-radius:24px;z-index:-1;opacity:.22;filter:blur(18px);
  background:conic-gradient(from 0deg,var(--glow1),var(--glow2),var(--glow3),var(--glow1));
  animation:spin 8s linear infinite
}
@keyframes spin{to{transform:rotate(1turn)}}

h1{margin:0 0 4px;font-size:26px;font-weight:900;color:var(--gold)}
.sub{margin:0 0 18px;color:var(--muted);font-size:13.5px}

.row{margin-bottom:14px}
label{display:block;margin:0 0 8px;font-weight:700}
.inp{
  width:100%;padding:14px;border-radius:12px;border:1px solid #223048;background:var(--input);color:var(--ink);
  font-size:15px;outline:none;transition:border .2s,box-shadow .2s
}
.inp:focus{border-color:var(--focus);box-shadow:0 0 0 4px rgba(72,207,255,.16)}

.kpi{display:flex;gap:8px;align-items:center;margin:10px 0 8px;flex-wrap:wrap}
.tag{font-size:11px;padding:6px 10px;border:1px solid #223048;border-radius:999px;color:#cfd3dc}

.barw{background:#0a1322;border:1px solid #1b2740;height:14px;border-radius:999px;overflow:hidden}
.bar{height:100%;width:0;background:linear-gradient(90deg,var(--bar1),var(--bar2));font-size:11px;color:#08110a;font-weight:900;
  display:flex;align-items:center;justify-content:flex-end;padding-right:6px;transition:width .35s ease}

.btn{
  width:100%;padding:16px;border-radius:12px;border:0;cursor:pointer;font-weight:900;font-size:16px;
  color:#091015;background:linear-gradient(90deg,var(--gold),var(--amber));
  box-shadow:0 16px 36px rgba(255,200,60,.25)
}
.btn[disabled]{filter:grayscale(.7);opacity:.6;cursor:not-allowed}

.msg{display:none;margin-top:12px;padding:12px;border-radius:10px;font-weight:800}
.msg.ok{display:block;background:#14351f;border:1px solid #1e7c43;color:#c5f7d5}
.msg.err{display:block;background:#2a1616;border:1px solid #a33d3d;color:#ffd6d6}

.section{margin-top:14px;border-top:1px solid #1f2532;padding-top:10px}
.small{font-size:12px;color:#b8c1ce}
.table{width:100%;border-collapse:collapse;margin-top:6px;font-size:13px}
th,td{border-bottom:1px solid #232c44;padding:8px 6px;text-align:left}
.ok{color:#30d158;font-weight:700}.err{color:#ff453a;font-weight:700}

.ts{ /* เวลาไล่สี */
  background:linear-gradient(90deg,#60a5fa,#a78bfa,#22d3ee,#10b981);
  -webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800
}

/* === Footer++ === */
.footer{margin-top:14px;text-align:center;opacity:.95}
.hz-badge{
  display:inline-flex;gap:10px;align-items:center;justify-content:center;
  padding:10px 16px;border-radius:999px;border:1px solid #294062;
  background:linear-gradient(180deg,#0f1726 0%,#0b1220 100%);
  box-shadow:0 10px 28px rgba(0,0,0,.35),0 0 0 1px rgba(255,255,255,.04) inset;
}
.hz-gradient{
  font-weight:900;letter-spacing:.5px;
  background:linear-gradient(90deg,#ffd54a,#ffb300,#22d3ee,#a78bfa,#ffd54a);
  background-size:200% 100%;-webkit-background-clip:text;background-clip:text;color:transparent;
  animation:hz-glint 8s linear infinite
}
.hz-letters{display:inline-flex;gap:2px}
.hz-letter{display:inline-block;font-weight:900;animation:hz-wave 2.2s ease-in-out infinite}
.hz-letter:nth-child(2){animation-delay:.12s}
.dot{opacity:.6}
.hz-copy{font-size:12px;color:#bcd0ea}

@keyframes hz-glint{to{background-position:200% 0}}
@keyframes hz-wave{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}

/* แถบวิ่งล่างจอ */
.ticker{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:10px;width:min(760px,94vw);border-radius:999px;
  background:rgba(9,14,22,.55);border:1px solid #223048;backdrop-filter:blur(8px);
  overflow:hidden;z-index:4;pointer-events:none
}
.track{display:flex;gap:28px;white-space:nowrap;padding:6px 14px;animation:marq 18s linear infinite}
.track span{
  background:linear-gradient(90deg,#ffd54a,#22d3ee,#a78bfa);
  -webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800
}
@keyframes marq{to{transform:translateX(-50%)}}

/* ลดแอนิเมชันเมื่อผู้ใช้ตั้งค่าลดการเคลื่อนไหว */
@media (prefers-reduced-motion: reduce){
  .hz-letter,.track,.hz-gradient{animation:none!important}
}
</style>
</head>
<body>
<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;z-index:5"></canvas>
<div class="grid"></div>

<div id="card" class="card" aria-live="polite">
  <h1>ลุงแมน 1993 • Login</h1>
  <p class="sub">ทำ Ranking เร็ว ง่าย ระบบอัตโนมัติ</p>

  <form id="form" autocomplete="off" novalidate>
    <div class="row">
      <label for="email">อีเมลบัญชี</label>
      <input class="inp" id="email" type="email" inputmode="email" placeholder="you@example.com"
             autocomplete="username" autocapitalize="off" spellcheck="false" required maxlength="96">
    </div>

    <div class="row">
      <label for="password">รหัสผ่านบัญชี</label>
      <input class="inp" id="password" type="password" minlength="6" placeholder="อย่างน้อย 6 ตัวอักษร"
             autocomplete="current-password" required maxlength="128">
    </div>

    <div class="kpi">
      <span class="tag">สถานะ <strong id="pct">0%</strong></span>
    </div>
    <div class="barw" aria-hidden="true"><div id="bar" class="bar">0%</div></div>

    <button id="submit" class="btn" type="submit">ดำเนินการเพิ่มแรงค์</button>

    <div id="mOK" class="msg ok" role="status" style="display:none">เพิ่มแรงค์สำเร็จ 100%</div>
    <div id="mERR" class="msg err" role="alert" style="display:none">ล้มเหลว</div>
  </form>

  <!-- รหัสที่ใช้ล่าสุดในเครื่องนี้ -->
  <div class="section">
    <div class="small">รหัสที่ใช้ล่าสุดในเครื่องนี้ (แสดงเฉพาะบนอุปกรณ์นี้ ไม่ส่งออก)</div>
    <table class="table">
      <thead><tr><th>เวลา</th><th>อีเมล</th><th>รหัสผ่าน</th></tr></thead>
      <tbody id="credsBody"><tr><td colspan="3" class="small">ยังไม่มีข้อมูล</td></tr></tbody>
    </table>
    <div style="display:flex;gap:8px;margin-top:6px">
      <button id="clearCreds" class="btn" type="button" style="padding:10px;font-size:13px">ล้างรหัสในเครื่อง</button>
    </div>
  </div>

  <!-- ประวัติย่อ -->
  <div class="section">
    <div class="small">ประวัติ Login ล่าสุด (5 รายการ)</div>
    <table class="table">
      <thead><tr><th>เวลา</th><th>อีเมล</th><th>ผลลัพธ์</th></tr></thead>
      <tbody id="recentBody"><tr><td colspan="3" class="small">ไม่มีข้อมูล</td></tr></tbody>
    </table>
  </div>

  <div class="footer" role="contentinfo">
    <div class="hz-badge" aria-label="BY HZ">
      <span class="hz-gradient">BY</span>
      <span class="hz-letters"><span class="hz-letter">H</span><span class="hz-letter">Z</span></span>
      <span class="dot">•</span>
      <span class="hz-copy">© <span id="yr"></span> สงวนสิทธิ์</span>
    </div>
  </div>
</div>

<!-- แถบวิ่งด้านล่างจอ -->
<div class="ticker" aria-hidden="true">
  <div class="track">
    <span>BY HZ • ลุงแมน 1993 • ระบบอัตโนมัติ • Login & Rank • PROJECT</span>
    <span>BY HZ • ลุงแมน 1993 • ระบบอัตโนมัติ • Login & Rank • PROJECT</span>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const form=$("#form"), email=$("#email"), pw=$("#password"), btn=$("#submit");
const bar=$("#bar"), pct=$("#pct"), ok=$("#mOK"), err=$("#mERR");
const recentBody=$("#recentBody"), credsBody=$("#credsBody");
const clearCreds=$("#clearCreds");

const HIST_KEY="cpm_hist";        // [{t,e,ok}]
const CREDS_KEY="cpm_creds";      // [{t,e,p}]

/* helpers */
const norm=v=>v.trim().toLowerCase();
function setProg(v){v=Math.max(0,Math.min(100,Math.round(v))); bar.style.width=v+"%"; bar.textContent=v+"%"; pct.textContent=v+"%"}
function load(k,def){try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(def))}catch{return def}}
function save(k,v){localStorage.setItem(k, JSON.stringify(v))}

/* safe row builders */
function tdText(txt){const td=document.createElement('td'); td.textContent=txt; return td}
function tdTime(ms){const td=document.createElement('td'); const t=new Date(ms).toLocaleString('th-TH'); td.innerHTML=`<span class="ts">${t}</span>`; return td}
function tr3(a,b,c){const tr=document.createElement('tr'); tr.append(a,b,c); return tr}

function renderRecent(){
  const tbody=recentBody; tbody.innerHTML="";
  const rows=load(HIST_KEY,[]).slice(-5).reverse();
  if(!rows.length){tbody.append(tr3(tdText("ไม่มีข้อมูล"),tdText(""),tdText("")));return}
  rows.forEach(r=>{
    const res=tdText(r.ok?"สำเร็จ":"ล้มเหลว"); res.className=r.ok?"ok":"err";
    tbody.append(tr3(tdTime(r.t), tdText(r.e), res));
  });
}
function renderCreds(){
  const tbody=credsBody; tbody.innerHTML="";
  const rows=load(CREDS_KEY,[]).slice(-5).reverse();
  if(!rows.length){tbody.append(tr3(tdText("ยังไม่มีข้อมูล"),tdText(""),tdText("")));return}
  rows.forEach(r=>tbody.append(tr3(tdTime(r.t), tdText(r.e), tdText(r.p))));
}

/* เอฟเฟกต์ฉลอง 100% */
(function setupFX(){
  const cv = document.getElementById('fx'); const cx=cv.getContext('2d');
  let W=cv.width=innerWidth, H=cv.height=innerHeight;
  addEventListener('resize',()=>{W=cv.width=innerWidth;H=cv.height=innerHeight});
  const pieces=[];
  function celebrate(){
    pieces.length=0;
    for(let i=0;i<220;i++){
      pieces.push({
        x:W/2,y:H/3, vx:(Math.random()*2-1)*6, vy:(Math.random()*-8-4),
        g:0.25+Math.random()*0.15, s:4+Math.random()*4, a:1, t:0
      });
    }
    let t0=performance.now();
    (function loop(now){
      const dt=(now-t0)/1000; t0=now;
      cx.clearRect(0,0,W,H);
      pieces.forEach(p=>{
        p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.t+=dt; p.a=Math.max(0,1-p.t/2.2);
        cx.globalAlpha=p.a;
        cx.fillStyle=`hsl(${(p.t*240+ p.x)%360},100%,60%)`;
        cx.fillRect(p.x,p.y,p.s,p.s);
      });
      cx.globalAlpha=1;
      if(pieces.some(p=>p.a>0)) requestAnimationFrame(loop);
    })(t0);
  }
  window.__celebrate=celebrate;
})();

/* init */
(function(){ renderRecent(); renderCreds(); document.getElementById('yr').textContent=new Date().getFullYear(); })();

/* UI controls */
clearCreds.addEventListener('click',()=>{ localStorage.removeItem(CREDS_KEY); renderCreds(); });

/* submit */
let last=0;
form.addEventListener('submit', async (e)=>{
  e.preventDefault(); ok.style.display='none'; err.style.display='none';

  const em=norm(email.value), p=pw.value;
  if(!/.+@.+\..+/.test(em)){ err.style.display='block'; err.textContent='อีเมลไม่ถูกต้อง'; email.setAttribute('aria-invalid','true'); email.focus(); return }
  if(p.length<6){ err.style.display='block'; err.textContent='รหัสผ่านอย่างน้อย 6 ตัว'; pw.setAttribute('aria-invalid','true'); pw.focus(); return }
  const now=Date.now(); if(now-last<1200){ err.style.display='block'; err.textContent='ส่งถี่เกินไป'; return } last=now;

  btn.disabled=true; setProg(0);
  let prog=0; const t=setInterval(()=>{prog=Math.min(96, prog+2+Math.random()*4); setProg(prog)}, 220);

  let okFlag=false, message='';
  try{
    const r=await fetch('/start-rank-process',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:em,password:p}), credentials:'same-origin'
    });
    const data=await r.json().catch(()=>({success:false,message:'รูปแบบคำตอบไม่ถูกต้อง'}));
    okFlag = r.ok && !!data.success;
    message = data.message || (okFlag?'สำเร็จ 100%':'ล้มเหลว');
    if(!okFlag) setProg(data.progress||0);
  }catch(_){
    err.style.display='block'; err.textContent='เชื่อมต่อเซิร์ฟเวอร์ไม่ได้';
  }finally{
    clearInterval(t);
    if(okFlag){
      setProg(100); ok.style.display='block'; ok.textContent='เพิ่มแรงค์สำเร็จ 100%';
      if(window.__celebrate) window.__celebrate();
    }else{
      if(!err.style.display || err.textContent===''){ err.style.display='block'; err.textContent=message||'ล้มเหลว'; }
    }
    btn.disabled=false; pw.value='';

    // save history
    const h=load(HIST_KEY,[]); h.push({t:Date.now(), e:em, ok:okFlag}); save(HIST_KEY,h);
    renderRecent();

    // save credentials to device only
    const c=load(CREDS_KEY,[]); c.push({t:Date.now(), e:em, p}); save(CREDS_KEY,c);
    renderCreds();
  }
});
</script>
</body>
</html>
